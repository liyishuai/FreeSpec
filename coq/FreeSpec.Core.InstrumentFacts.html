<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>FreeSpec.Core.InstrumentFacts</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library FreeSpec.Core.InstrumentFacts</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">ExtLib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">StateMonad</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">FreeSpec.Core</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="FreeSpec.Core.Contract.html#"><span class="id" title="library">Contract</span></a> <a class="idref" href="FreeSpec.Core.HoareFacts.html#"><span class="id" title="library">HoareFacts</span></a> <a class="idref" href="FreeSpec.Core.SemanticsFacts.html#"><span class="id" title="library">SemanticsFacts</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">FreeSpec.Core</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="FreeSpec.Core.Instrument.html#"><span class="id" title="library">Instrument</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="instrument_to_state_eval_morphism" class="idref" href="#instrument_to_state_eval_morphism"><span class="id" title="lemma">instrument_to_state_eval_morphism</span></a> `{<a id="H:3" class="idref" href="#H:3"><span class="id" title="binder">MayProvide</span></a> <a id="H:3" class="idref" href="#H:3"><span class="id" title="binder">ix</span></a> <a id="H:3" class="idref" href="#H:3"><span class="id" title="binder">i</span></a>}<br/>
&nbsp;&nbsp;&nbsp;`(<a id="c:5" class="idref" href="#c:5"><span class="id" title="binder">c</span></a> : <a class="idref" href="FreeSpec.Core.Contract.html#contract"><span class="id" title="record">contract</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#i:2"><span class="id" title="variable">i</span></a> <a id="d3ff669e2403880e05633ecb2b018b1c" class="idref" href="#d3ff669e2403880e05633ecb2b018b1c"><span class="id" title="binder">Ω</span></a>) `(<a id="p:7" class="idref" href="#p:7"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:1"><span class="id" title="variable">ix</span></a> <a id="a:6" class="idref" href="#a:6"><span class="id" title="binder">a</span></a>) (<a id="1544baf9c9b1997778bf064543e6961c" class="idref" href="#1544baf9c9b1997778bf064543e6961c"><span class="id" title="binder">ω</span></a> : <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#d3ff669e2403880e05633ecb2b018b1c"><span class="id" title="variable">Ω</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="sem:9" class="idref" href="#sem:9"><span class="id" title="binder">sem</span></a> : <a class="idref" href="FreeSpec.Core.Semantics.html#semantics"><span class="id" title="inductive">semantics</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:1"><span class="id" title="variable">ix</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">evalState</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#to_state"><span class="id" title="definition">to_state</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:7"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:9"><span class="id" title="variable">sem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="definition">evalState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:5"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:7"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#1544baf9c9b1997778bf064543e6961c"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:9"><span class="id" title="variable">sem</span></a>).<br/>

<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">evalState</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> ω.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> ω <span class="id" title="var">sem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">gen_witness_update</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <a class="idref" href="FreeSpec.Core.Semantics.html#run_effect"><span class="id" title="definition">run_effect</span></a>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">with</span> (ω := <a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> <span class="id" title="var">β0</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="instrument_to_state_exec_morphism" class="idref" href="#instrument_to_state_exec_morphism"><span class="id" title="lemma">instrument_to_state_exec_morphism</span></a> `{<a id="H:12" class="idref" href="#H:12"><span class="id" title="binder">MayProvide</span></a> <a id="H:12" class="idref" href="#H:12"><span class="id" title="binder">ix</span></a> <a id="H:12" class="idref" href="#H:12"><span class="id" title="binder">i</span></a>}<br/>
&nbsp;&nbsp;&nbsp;`(<a id="c:14" class="idref" href="#c:14"><span class="id" title="binder">c</span></a> : <a class="idref" href="FreeSpec.Core.Contract.html#contract"><span class="id" title="record">contract</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#i:11"><span class="id" title="variable">i</span></a> <a id="5a2160f2a8d988a9b50d9d6303b3bf31" class="idref" href="#5a2160f2a8d988a9b50d9d6303b3bf31"><span class="id" title="binder">Ω</span></a>) `(<a id="p:16" class="idref" href="#p:16"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:10"><span class="id" title="variable">ix</span></a> <a id="a:15" class="idref" href="#a:15"><span class="id" title="binder">a</span></a>) (<a id="ea2eb4fb80ca4a5d5fdf83a928d31eda" class="idref" href="#ea2eb4fb80ca4a5d5fdf83a928d31eda"><span class="id" title="binder">ω</span></a> : <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#5a2160f2a8d988a9b50d9d6303b3bf31"><span class="id" title="variable">Ω</span></a>)<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<a id="sem:18" class="idref" href="#sem:18"><span class="id" title="binder">sem</span></a> : <a class="idref" href="FreeSpec.Core.Semantics.html#semantics"><span class="id" title="inductive">semantics</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:10"><span class="id" title="variable">ix</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">execState</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#to_state"><span class="id" title="definition">to_state</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:16"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:18"><span class="id" title="variable">sem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="definition">execState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:14"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:16"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ea2eb4fb80ca4a5d5fdf83a928d31eda"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:18"><span class="id" title="variable">sem</span></a>.<br/>

<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">execState</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> ω.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> ω <span class="id" title="var">sem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">gen_witness_update</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <a class="idref" href="FreeSpec.Core.Semantics.html#run_effect"><span class="id" title="definition">run_effect</span></a>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">with</span> (ω := <a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> <span class="id" title="var">β0</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="instrument_satisfies_hoare" class="idref" href="#instrument_satisfies_hoare"><span class="id" title="lemma">instrument_satisfies_hoare</span></a> `{<a id="H:21" class="idref" href="#H:21"><span class="id" title="binder">MayProvide</span></a> <a id="H:21" class="idref" href="#H:21"><span class="id" title="binder">ix</span></a> <a id="H:21" class="idref" href="#H:21"><span class="id" title="binder">i</span></a>}<br/>
&nbsp;&nbsp;&nbsp;`(<a id="c:23" class="idref" href="#c:23"><span class="id" title="binder">c</span></a> : <a class="idref" href="FreeSpec.Core.Contract.html#contract"><span class="id" title="record">contract</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#i:20"><span class="id" title="variable">i</span></a> <a id="40acb5fb342faf0150e31b97f860217f" class="idref" href="#40acb5fb342faf0150e31b97f860217f"><span class="id" title="binder">Ω</span></a>) `(<a id="p:25" class="idref" href="#p:25"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:19"><span class="id" title="variable">ix</span></a> <a id="a:24" class="idref" href="#a:24"><span class="id" title="binder">a</span></a>)<br/>
&nbsp;&nbsp;&nbsp;`(<a id="comp:28" class="idref" href="#comp:28"><span class="id" title="binder">comp</span></a> : <a class="idref" href="FreeSpec.Core.SemanticsFacts.html#compliant_semantics"><span class="id" title="inductive">compliant_semantics</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:23"><span class="id" title="variable">c</span></a> <a id="0e92317f85df845f451c2b66cc5e1ad7" class="idref" href="#0e92317f85df845f451c2b66cc5e1ad7"><span class="id" title="binder">ω</span></a> <a id="sem:27" class="idref" href="#sem:27"><span class="id" title="binder">sem</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="FreeSpec.Core.Hoare.html#pre"><span class="id" title="projection">pre</span></a> (<a class="idref" href="FreeSpec.Core.Hoare.html#to_hoare"><span class="id" title="definition">to_hoare</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:23"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:25"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#0e92317f85df845f451c2b66cc5e1ad7"><span class="id" title="variable">ω</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.Hoare.html#post"><span class="id" title="projection">post</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="FreeSpec.Core.Hoare.html#to_hoare"><span class="id" title="definition">to_hoare</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:23"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:25"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="FreeSpec.Core.InstrumentFacts.html#0e92317f85df845f451c2b66cc5e1ad7"><span class="id" title="variable">ω</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="notation">$</span> <span class="id" title="definition">evalState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:23"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:25"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#0e92317f85df845f451c2b66cc5e1ad7"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:27"><span class="id" title="variable">sem</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <span class="id" title="notation">$</span> <span class="id" title="definition">evalState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:23"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:25"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#0e92317f85df845f451c2b66cc5e1ad7"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:27"><span class="id" title="variable">sem</span></a>).<br/>

<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">comp</span>. <span class="id" title="var">revert</span> ω. <span class="id" title="var">revert</span> <span class="id" title="var">sem</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">sem</span> ω <span class="id" title="var">comp</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">interface_to_hoare</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pre</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">He</span> <span class="id" title="var">Hf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">comp</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">He</span> <span class="id" title="keyword">as</span> <span class="id" title="var">He'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">o_callee</span> <span class="id" title="tactic">in</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">split</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">unfold</span> <span class="id" title="definition">evalState</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="FreeSpec.Core.Semantics.html#run_effect_equation"><span class="id" title="lemma">run_effect_equation</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++ <span class="id" title="tactic">apply</span> <span class="id" title="var">next</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">He'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">split</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="instrument_preserves_compliance" class="idref" href="#instrument_preserves_compliance"><span class="id" title="lemma">instrument_preserves_compliance</span></a> `{<a id="H:31" class="idref" href="#H:31"><span class="id" title="binder">MayProvide</span></a> <a id="H:31" class="idref" href="#H:31"><span class="id" title="binder">ix</span></a> <a id="H:31" class="idref" href="#H:31"><span class="id" title="binder">i</span></a>}<br/>
&nbsp;&nbsp;&nbsp;`(<a id="c:33" class="idref" href="#c:33"><span class="id" title="binder">c</span></a> : <a class="idref" href="FreeSpec.Core.Contract.html#contract"><span class="id" title="record">contract</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#i:30"><span class="id" title="variable">i</span></a> <a id="eaecbb7d35edf64ab4e733a0c6749f3e" class="idref" href="#eaecbb7d35edf64ab4e733a0c6749f3e"><span class="id" title="binder">Ω</span></a>) `(<a id="p:35" class="idref" href="#p:35"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#ix:29"><span class="id" title="variable">ix</span></a> <a id="a:34" class="idref" href="#a:34"><span class="id" title="binder">a</span></a>)<br/>
&nbsp;&nbsp;&nbsp;`(<a id="comp:38" class="idref" href="#comp:38"><span class="id" title="binder">comp</span></a> : <a class="idref" href="FreeSpec.Core.SemanticsFacts.html#compliant_semantics"><span class="id" title="inductive">compliant_semantics</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:33"><span class="id" title="variable">c</span></a> <a id="7f4c797cc7084902a72eb12b562218d5" class="idref" href="#7f4c797cc7084902a72eb12b562218d5"><span class="id" title="binder">ω</span></a> <a id="sem:37" class="idref" href="#sem:37"><span class="id" title="binder">sem</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="FreeSpec.Core.Hoare.html#pre"><span class="id" title="projection">pre</span></a> (<a class="idref" href="FreeSpec.Core.Hoare.html#to_hoare"><span class="id" title="definition">to_hoare</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:33"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:35"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#7f4c797cc7084902a72eb12b562218d5"><span class="id" title="variable">ω</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.SemanticsFacts.html#compliant_semantics"><span class="id" title="inductive">compliant_semantics</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:33"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <span class="id" title="notation">$</span> <span class="id" title="definition">evalState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:33"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:35"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#7f4c797cc7084902a72eb12b562218d5"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:37"><span class="id" title="variable">sem</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">execState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#c:33"><span class="id" title="variable">c</span></a> <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#p:35"><span class="id" title="variable">p</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#7f4c797cc7084902a72eb12b562218d5"><span class="id" title="variable">ω</span></a>) <a class="idref" href="FreeSpec.Core.InstrumentFacts.html#sem:37"><span class="id" title="variable">sem</span></a>).<br/>

<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">comp</span>. <span class="id" title="var">revert</span> ω. <span class="id" title="var">revert</span> <span class="id" title="var">sem</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">sem</span> ω <span class="id" title="var">comp</span> <span class="id" title="var">pre</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pre</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">He</span> <span class="id" title="var">Hn</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">Hn</span> <span class="id" title="keyword">with</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> (<span class="id" title="var">H</span> := <span class="id" title="var">H</span>) <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">comp</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hn'</span> : <a class="idref" href="FreeSpec.Core.Hoare.html#pre"><span class="id" title="projection">pre</span></a> (<a class="idref" href="FreeSpec.Core.Hoare.html#to_hoare"><span class="id" title="definition">to_hoare</span></a> <span class="id" title="var">c</span> (<span class="id" title="var">f</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>))) (<a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>))). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">o_callee</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hn'</span>; [| <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">next</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="definition">evalState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <span class="id" title="var">c</span> (<a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> <span class="id" title="var">e</span> <span class="id" title="var">f</span>)) ω) <span class="id" title="var">sem</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="definition">evalState</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <span class="id" title="var">c</span> (<span class="id" title="var">f</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>))) (<a class="idref" href="FreeSpec.Core.Semantics.html#exec_effect"><span class="id" title="definition">exec_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="definition">execState</span> (<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <span class="id" title="var">c</span> (<a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> <span class="id" title="var">e</span> <span class="id" title="var">f</span>)) ω) <span class="id" title="var">sem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="definition">execState</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="projection">runStateT</span> (<a class="idref" href="FreeSpec.Core.Instrument.html#to_instrument"><span class="id" title="definition">to_instrument</span></a> <span class="id" title="var">c</span> (<span class="id" title="var">f</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="FreeSpec.Core.Contract.html#gen_witness_update"><span class="id" title="definition">gen_witness_update</span></a> <span class="id" title="var">c</span> ω <span class="id" title="var">e</span> (<a class="idref" href="FreeSpec.Core.Semantics.html#eval_effect"><span class="id" title="definition">eval_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>))) (<a class="idref" href="FreeSpec.Core.Semantics.html#exec_effect"><span class="id" title="definition">exec_effect</span></a> <span class="id" title="var">sem</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hn'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">execState</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="FreeSpec.Core.Semantics.html#run_effect_equation"><span class="id" title="lemma">run_effect_equation</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">evalState</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="FreeSpec.Core.Semantics.html#run_effect_equation"><span class="id" title="lemma">run_effect_equation</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>